# 0. 서버에 과도한 트래픽이 몰리면 어떻게 해야 할까?

인기가 아주 많은 햄버거 가게가 있다고 가정해보자. 많은 손님의 계산을 처리하려면 두 가지 방법이 있다.

하나는 계산 속도를 높이는 것이고, 다른 하나는 계산대를 늘리는 것이다.

계산 속도를 높이면 계산대 하나만 관리하면 되기 때문에 관리가 쉬운 장점이 있지만, 성능을 올리는 데 비용이 많이 들고, 계산대가 고장 나면 전체 계산을 멈추게 된다는 단점이 있다.

반면 계산대를 늘리는 방법은 손님을 적절히 분산시켜주는 직원이 필요하다. 계산대 하나가 고장 나더라도 다른 계산대로 대응할 수 있다는 장점이 있지만, 계산대 수가 많아지면 관리가 복잡해진다는 단점이 있다.

이처럼 계산 속도를 높이는 방법을 **Scale-up**, 계산대를 늘리는 방법을 **Scale-out**이라고 한다.

| 전략 | 설명 | 장점 | 단점 |
| --- | --- | --- | --- |
| Scale-up | 기존 서버의 성능 향상 (CPU, RAM 등) | 유지관리 용이, 캐시 히트율 상승 | 높은 비용, 단일 장애점(SPOF) |
| Scale-out | 여러 서버를 추가하여 트래픽 분산 | 비용 절감, 요청 분산 가능 | 관리 복잡, 서버 수 증가 시 어려움 |

이 중 **Scale-out** 전략에서는 요청을 여러 서버로 분산해줄 **로드 밸런서**가 필요하다. 이때 손님을 계산대로 나눠 보내주는 직원을 로드 밸런서에 비유할 수 있다.



# 1. 로드 밸런싱이란?

> 다수의 서버에 네트워크 요청을 균등하게 분산하여 트래픽 부하를 분산시키는 프로세스다.
> 

### 1.1 목적

- **서비스 안정성** 확보
→ 서버 상태를 확인해 정상 서버로만 요청을 전달하여 서비스 중단을 방지
- **확장성** 확보
→ 트래픽 증가에 유연하게 대응 가능한 구조로, 인프라 확장에 유리
- **보안성** 향상
→ 악의적인 트래픽을 필터링하거나 분산시켜 보안 위협을 줄일 수 있음 (ex. DDoS 방어)



# 2. 로드 밸런서

> 로드 밸런서는 서버에 가해지는 트래픽을 여러 대의 서버에 균등하게 분산시켜주는 역할을 한다.
> 
> 
> 즉, 어떤 요청이 어떤 서버로 전달될지를 결정하는 구성 요소다.
> 

종류는 다양하지만 가장 많이 활용되는 것은 **L4 로드 밸런서**와 **L7 로드 밸런서**다.



### 2.1 L4 로드 밸런서 (전송 계층 기반)

- **IP 주소**, **포트 번호**, **TCP/UDP** 프로토콜 정보를 기준으로 요청을 분산
- 요청의 실제 내용은 보지 않음

**특징**

- 빠르고 가볍다 (내용 분석 X)
- 데이터 복호화가 없어 보안 측면에서 유리
- 단순한 트래픽 분산에 적합

**사용 예시**

- TCP 기반의 API 서버
- 빠른 응답이 중요한 실시간 게임 서버
- 예: “포트 80으로 들어온 요청은 round-robin 방식으로 분산하자”



### 2.2 L7 로드 밸런서 (응용 계층 기반)

- **URL 경로**, **HTTP 헤더**, **쿠키**, **Request Body** 등을 기준으로 요청을 분산

**특징**

- 요청 내용을 파악하여 **세밀한 제어**가 가능
- **보안 필터링**, **캐싱**, **인증 연동** 등의 기능 가능
- 처리 과정에서 복호화 필요 → 속도는 다소 느리고 비용이 높을 수 있음

**사용 예시**

- 로그인, 파일 업로드 등 다양한 요청을 처리하는 웹 애플리케이션
- 마이크로서비스 구조에서 각 서비스로의 라우팅
- 예: “`/login` 요청은 인증 서버로, `/image` 요청은 이미지 서버로 분산하자”



### 2.3 정리

| 항목 | L4 로드 밸런서 | L7 로드 밸런서 |
| --- | --- | --- |
| 기준 계층 | 전송 계층 (TCP/UDP, 포트 등) | 응용 계층 (HTTP 헤더, URI, 쿠키 등) |
| 라우팅 방식 | IP/포트 기반 라우팅 | 요청 내용을 분석하여 라우팅 |
| 장점 | 빠른 속도, 단순 구조, 저렴한 비용 | 세밀한 제어, 캐싱/보안 필터링 가능 |
| 단점 | 세밀한 제어 불가, IP 변경에 취약 | 복호화 필요, 설정 복잡, 리소스 및 비용 증가 |



# 3. 로드 밸런싱 알고리즘

클라이언트 요청을 어떤 서버에 보낼지 결정하는 방식이다.

상황에 따라 적절한 알고리즘을 선택하는 것이 중요하다.


### 3.1 Round Robin (라운드 로빈)

- 서버에 순서대로 요청을 분배
예: A → B → C → A → B …

**장점**

- 간단한 설정
- 서버 성능이 유사할 때 유용

**단점**

- 서버 성능 차이를 고려하지 않음


### 3.2 Weighted Round Robin (가중 라운드 로빈)

- 서버 성능에 따라 가중치를 설정하고, 그 비율대로 요청을 분배
예: A(5), B(2) → AAAAA BB AAAAA BB …

**장점**

- 서버 성능을 반영할 수 있음

**단점**

- 정적 가중치로 실시간 부하 반영이 어려움


### 3.3 Least Connection (최소 연결 수 방식)

- 현재 연결된 클라이언트 수가 가장 적은 서버에 요청을 분배

**장점**

- 실시간 부하 반영에 효과적

**단점**

- 단순 연결 수만 보기 때문에 부하의 정확한 정도는 판단 어려움


### 3.4 Weighted Least Connection (가중 최소 연결 수 방식)

- 서버 성능도 고려하면서, 연결 수가 적은 서버에 우선적으로 요청을 분배

**장점**

- 다양한 상황에 유연하게 대응 가능

**단점**

- 설정과 구현이 상대적으로 복잡함


### 3.5 Fastest Response Time (가장 빠른 응답 시간)

- 응답 속도가 가장 빠른 서버로 요청을 분배

**장점**

- 실제 사용자 입장에서의 체감 속도 향상

**단점**

- 응답 시간 측정이 일시적일 수 있고, 환경에 따라 달라질 수 있음


### 3.6 IP Hash

- 클라이언트 IP를 해시하여 항상 **같은 서버**에 연결되도록 분배

**장점**

- 세션 일관성 유지에 유리 (예: 로그인 유지)

**단점**

- 서버가 줄어들거나 바뀌면 해시 충돌 가능


### 3.7 정리

| 알고리즘 이름 | 동작 방식 | 장점 | 단점 | 추천 상황 |
| --- | --- | --- | --- | --- |
| Round Robin | 서버에 순서대로 요청 분배 | 간단한 설정, 성능 유사 시 효율적 | 성능 차이 반영 불가 | 서버 성능이 비슷할 때 |
| Weighted Round Robin | 가중치에 따라 비율 조정 | 성능 차이 반영 가능 | 실시간 부하 반영 어려움 | 서버 성능이 다를 때 |
| Least Connection | 연결 수 가장 적은 서버 선택 | 실시간 부하 반영 가능 | 연결 수만 고려함 | 요청 처리 시간이 불규칙할 때 |
| Weighted Least Connection | 성능 고려 + 연결 수 분산 | 다양한 상황에 유연한 대응 가능 | 설정 복잡 | 서버 성능이 다양할 때 |
| Fastest Response | 응답 시간 가장 빠른 서버로 분배 | 사용자 체감 속도 개선 가능 | 응답 시간 변동성에 민감 | 실시간 반응성이 중요한 서비스 |
| IP Hash | IP 해싱으로 고정 서버 매핑 | 세션 유지 가능 | 서버 변경 시 해시 충돌 가능 | 로그인 등 세션 일관성이 필요한 경우 |
